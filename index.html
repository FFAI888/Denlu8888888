<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BSC 钱包登录页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        button {
            padding: 15px 30px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            background-color: #f6851b;
            color: white;
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #e2761b;
        }
        #wallet-address {
            margin-top: 20px;
            font-weight: bold;
        }
        #network-status {
            margin-top: 10px;
            font-size: 14px;
            color: #555;
        }
    </style>
</head>
<body>
    <h1>登录 BSC 钱包</h1>
    <button id="connectWallet">连接钱包</button>
    <div id="wallet-address"></div>
    <div id="network-status"></div>

    <script>
        const connectWalletButton = document.getElementById('connectWallet');
        const walletAddressDiv = document.getElementById('wallet-address');
        const networkStatusDiv = document.getElementById('network-status');

        // BSC 主网信息
        const BSC_PARAMS = {
            chainId: '0x38', // 56 十六进制
            chainName: 'Binance Smart Chain',
            nativeCurrency: {
                name: 'BNB',
                symbol: 'BNB',
                decimals: 18
            },
            rpcUrls: ['https://bsc-dataseed.binance.org/'],
            blockExplorerUrls: ['https://bscscan.com/']
        };

        const TARGET_NETWORK_ID = '56';

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // 请求连接钱包
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const account = accounts[0];
                    walletAddressDiv.innerText = `已连接钱包地址: ${account}`;
                    connectWalletButton.innerText = "已连接";
                    connectWalletButton.disabled = true;

                    // 检测网络
                    const networkId = await window.ethereum.request({ method: 'net_version' });

                    // 如果用户未添加 BSC 网络，尝试提示添加
                    if (networkId !== TARGET_NETWORK_ID) {
                        try {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [BSC_PARAMS]
                            });
                        } catch (addError) {
                            console.warn('无法自动添加 BSC 网络，请手动切换');
                        }
                    }

                    checkNetwork(networkId);

                    // 监听网络切换
                    window.ethereum.on('chainChanged', handleNetworkChange);
                } catch (error) {
                    console.error(error);
                    alert('钱包连接失败，请重试。');
                }
            } else {
                alert('未检测到 MetaMask，请先安装 MetaMask 插件。');
            }
        }

        function checkNetwork(networkId) {
            if (networkId === TARGET_NETWORK_ID) {
                networkStatusDiv.innerText = '当前网络正确：BSC 主网';
                networkStatusDiv.style.color = 'green';
            } else {
                networkStatusDiv.innerText = `当前网络错误（ID: ${networkId}），请切换到 BSC 主网`;
                networkStatusDiv.style.color = 'red';
            }
        }

        function handleNetworkChange(chainId) {
            const networkId = parseInt(chainId, 16).toString();
            checkNetwork(networkId);
        }

        connectWalletButton.addEventListener('click', connectWallet);
    </script>
</body>
</html>
